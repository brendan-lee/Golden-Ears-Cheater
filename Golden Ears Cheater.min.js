function getUrlParams(){for(var e=location.search.substr(1).split("&"),t={},n=0;n<e.length;n++){var i=e[n].split("=");t[i[0]]=i[1]}return t}function getTestID(){return getUrlParams().id}function getTestType(){return getUrlParams().type}function getFileNameByUri(e){return e.substring(e.lastIndexOf("/")+1)}function Question(e){this.data=e,this.getMusicFileNameByEnID=function(e){var t=this.getMusicDataBy("EncodeMusicId",e);if(null!==t){return getFileNameByUri(t.MusicPath)}return""},this.getMusicDataBy=function(e,t,n){n=void 0===n||n;for(var i=this.data.gearsExamOptionsList,r=0;r<i.length;r++){var a=i[r];if(n){if(a[e]===t)return a}else if(a[e].indexOf(t)>-1)return a}return null}}function Test(e){this.data=e,this.getMusicDataBy=function(e,t,n){for(var i=this.data,r=0;r<i.length;r++){var a=i[r],u=a.getMusicDataBy(e,t,n);if(null!==u)return u}return null}}function getTestData(e){var t=$.Deferred();return $.ajax({url:"/ajax/ears.ashx",type:"POST",dataType:"json",timeout:5e3,data:{testItemId:e,action:"checkexamoptionsright"}}).done(function(e){for(var n=[],i=0;i<e.length;i++)n.push(new Question(e[i]));t.resolve(new Test(n))}).fail(function(){t.reject()}),t}function getQuesNum(){return parseInt($("#divList").children("a[class='on']").html())-1}function getCurMusicEnID(){return $("#divMainTitle").attr("data-musicid")}function getMusicFileNameByEnID(e){for(var t=$("#divAudio").children("audio"),n=0;n<t.length;n++){var i=t.eq(n);if(i.attr("id")===e){return getFileNameByUri(i.children("source").attr("src"))}}return""}function getMusicEnIDByFileName(e){for(var t=$("#divAudio").children("audio"),n=0;n<t.length;n++){var i=t.eq(n);if(i.children("source").attr("src").indexOf(e)>-1)return i.attr("id")}return""}function getAnsNumByMusicEnID(e){for(var t=$("#divMainInfo").children("ul[data-type='1']"),n=t.children("li"),i=0;i<n.length;i++){if(n.eq(i).attr("data-tag")===e)return i}return-1}function isCorrect(e,t,n,i,r,a,u,c){var s=$.Deferred(),o=r.ExamineSubIdStr,l=r.EncodeMusicId;return $.ajax({url:"/ajax/ears.ashx",type:"POST",timeout:5e3,data:{type:t,timespan:i,testItemId:e,musicId:o,isIncrease:void 0===a?"":a,isFinish:void 0===c?"":c,examineId:n,encodeMusicId:l,affectValue:void 0===u?"":u,action:"checkexamoptionsright"}}).done(function(e){s.resolve("1"===e)}).fail(function(){s.reject()}),s}function getAnswer(e,t,n,i){var r=$.Deferred(),a=n.data[i],u=a.data.examineId,c=a.data.timestamp.toString(),s=a.data.gearsExamOptionsList,o=function(i){var r=$.Deferred(),a=getMusicFileNameByEnID(getCurMusicEnID()),s=n.getMusicDataBy("MusicPath",a,!1);u=s.ExamineId;for(var o=getOptTags(i),l=0;l<o.length;l++)!function(n){var i=o[n];isCorrect(e,t,u,c,s,i).done(function(e){e&&r.resolve(n)}).fail(function(){r.reject()})}(l);return r};switch(t){case"1":(function(){for(var n=$.Deferred(),i=0;i<s.length;i++){var r=s[i];!function(i){isCorrect(e,t,u,c,i).done(function(e){if(e){var t=getFileNameByUri(i.MusicPath),r=getAnsNumByMusicEnID(getMusicEnIDByFileName(t));n.resolve(r)}}).fail(function(){n.reject()})}(r)}return n})().done(function(e){r.resolve(e)}).fail(function(){r.reject()});break;case"2":case"5":o(1).done(function(e){r.resolve(e)}).fail(function(){r.reject()});break;case"3":case"4":$.when(o(0),function(){var i=$.Deferred(),r=getMusicFileNameByEnID(getCurMusicEnID()),a=n.getMusicDataBy("MusicPath",r,!1);u=a.ExamineId;for(var s=getOptTags(1),o=0;o<s.length;o++)!function(n){var r=s[n];isCorrect(e,t,u,c,a,"",r).done(function(e){e&&i.resolve(n)}).fail(function(){i.reject()})}(o);return i}()).done(function(e,t){r.resolve(e,t)}).fail(function(){r.reject()})}return r}function getOpts(e){for(var t=$(0===e?"#divMainTitle":"#divMainInfo").children("ul[data-type]"),n=0;n<t.length;n++)if("none"!==t.eq(n).css("display"))return t.eq(n).children("li")}function getOpt(e,t){return getOpts(e).eq(t)}function getOptTags(e){for(var t=getOpts(e),n=[],i=0;i<t.length;i++)n.push(t.eq(i).attr("data-tag"));return n}function autoClickAnswer(){var e=getTestID(),t=getTestType(),n=getQuesNum();getTestData(e).done(function(i){getAnswer(e,t,i,n).done(function(e,n){switch(t){case"1":case"2":case"5":getOpt(1,e).children("a").click();break;case"3":case"4":$(".play-box").addClass("on");var i=$("a.bg-next");i.click(),getOpt(0,e).children("a").click(),getOpt(1,n).children("a").click(),i.click()}}).fail(function(){alert("网络连接失败，请稍候再试")})}).fail(function(){alert("网络连接失败，请稍候再试")})}function getQuesCount(){return $("#divList").children().length}function autoCompleteTest(e){autoClickAnswer();var t=$("#divList").children("a").eq(getQuesNum()),n=setInterval(function(){t.hasClass("finish")&&(clearInterval(n),autoCompleteTest(e))},e)}autoCompleteTest(50);